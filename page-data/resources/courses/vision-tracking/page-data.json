{"componentChunkName":"component---src-components-markdown-template-js","path":"/resources/courses/vision-tracking","result":{"data":{"markdownRemark":{"html":"<p>To start out let's lay out the bits of information that we have to start with. We know the following:</p>\n<ul>\n<li>The dimensions of the target</li>\n<li>The field of vision of the camera</li>\n<li>The target is retro reflective</li>\n</ul>\n<p>The first thing we will want to do is acquire a useful image. In this case we will illuminate the retro reflective tape to create two very bright targets. This is the image which the camera will see.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 320px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 80%; position: relative; bottom: 0; left: 0; background-image: url('data:image/svg+xml,%3csvg%20xmlns=\\'http://www.w3.org/2000/svg\\'%20width=\\'400\\'%20height=\\'320\\'%3e%3cpath%20d=\\'M0%20160v160h401V0H0v160m220-25l-7%202c-1%201%203%2055%204%2057l23-3c1-1-4-54-6-56h-14m-88%208l-9%201c-1%201%201%2046%202%2056v5h11l12-2v-16l-2-30c-1-17%201-15-14-14\\'%20fill=\\'%23d3d3d3\\'%20fill-rule=\\'evenodd\\'/%3e%3c/svg%3e'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Full color image of vision target\"\n        title=\"Full color image of vision target\"\n        src=\"/static/c1cacb358de0a5f79771e1f3a92e7d74/72799/target.png\"\n        srcset=\"/static/c1cacb358de0a5f79771e1f3a92e7d74/5a46d/target.png 300w,\n/static/c1cacb358de0a5f79771e1f3a92e7d74/72799/target.png 320w\"\n        sizes=\"(max-width: 320px) 100vw, 320px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>Now to find only the vision targets we first must filter out the green targets, this can be done in a variety of ways but by far the easiest one is applying a threshold over the image. Applying a threshold consists of selecting a range for each of the image channels, then if a pixel falls within the values it gets set to white, when not it gets set to black. In particular this is called a binary threshold. We want to filter out the retro reflective tape which is very bright, therefor we will want to covert the image to hsv to facilitate the creation of a threshold.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/svg+xml,%3csvg%20xmlns=\\'http://www.w3.org/2000/svg\\'%20width=\\'400\\'%20height=\\'107\\'%3e%3cpath%20d=\\'M133%2054v53h267V0H133v54M73%2044h-2l-3%201-1%202v2c2%201%203%204%201%204v2l-1%202c-1%201-1%201%201%203l2%203%201%201%201%202h3l4-1%201-4a2585%202585%200%2001-2-17l-3-1-2%201m134%201h-3l1%209c0%2011%201%2011%205%2010h4l-1-7c-1-12-1-13-6-12m132%200c-2%200-2%200-1%209%200%2011%201%2011%206%2011l3-1-1-9c0-12%200-12-7-10M40%2058c0%2010%201%2011%202%2011l2%201v1l1-1h6l-1-10V48c0-1-1-2-5-2l-5%201v11m134-10l1%2020c1%201%208%200%208-2V48l-4-1-5%201m133%201l1%2020%204-1%204-1v-9l-1-10c-1-2-7-1-8%201M57%2058c-2%201-3%203-1%203%201%200%202%202%201%208v8h9l2-1%201-1c2-1%202-1-1-2-4-2-4-2-3-3h4v-2c1%200%202%200%201-1l-3-1h-2l1-2v-3l-1-2c-1-3-5-4-8-1m4%2025l-1%201v1l-1%206c0%204%200%205%202%204v1c-1%201-1%201%202%201%203%201%207-2%205-4-1-2-1-2%201-3v-1l-2-2-2-2c-2%200-2%200-1-1%202-1%202-1%200-1h-3\\'%20fill=\\'%23d3d3d3\\'%20fill-rule=\\'evenodd\\'/%3e%3c/svg%3e'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Hue, Saturation, and Value channels of the target\"\n        title=\"Hue, Saturation, and Value channels of the target\"\n        src=\"/static/0f66dfae9e71490030f1c8e944e06a86/d9199/target-hsv.png\"\n        srcset=\"/static/0f66dfae9e71490030f1c8e944e06a86/5a46d/target-hsv.png 300w,\n/static/0f66dfae9e71490030f1c8e944e06a86/0a47e/target-hsv.png 600w,\n/static/0f66dfae9e71490030f1c8e944e06a86/d9199/target-hsv.png 960w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>As we can see from the three images the tape has a very distinct hue and value but the saturation varies greatly. As a result it is of advantage to us to use only the hue and value channels in our threshold rather than trying to include saturation. When we apply the threshold to the image we get the following image which is either black or white. This is called a binary image.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 320px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 80%; position: relative; bottom: 0; left: 0; background-image: url('data:image/svg+xml,%3csvg%20xmlns=\\'http://www.w3.org/2000/svg\\'%20width=\\'400\\'%20height=\\'320\\'%3e%3cpath%20d=\\'M0%20160v160h401V0H0v160m216-23h-3v8l2%209%201%2010%201%2019%201%2010%2010-1c12%200%2012%200%2012-3l-2-17-2-16-1-8c0-12%200-12-9-12l-10%201m-84%207c-10%200-9%200-9%2018l2%2016%201%202v24h5l11-1h6l-1-16-1-16-1-15v-13h-4l-9%201\\'%20fill=\\'%23d3d3d3\\'%20fill-rule=\\'evenodd\\'/%3e%3c/svg%3e'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"The binary image of the target\"\n        title=\"The binary image of the target\"\n        src=\"/static/901bd27780f25fbdf77cb3e65ac90136/72799/target-binary.png\"\n        srcset=\"/static/901bd27780f25fbdf77cb3e65ac90136/5a46d/target-binary.png 300w,\n/static/901bd27780f25fbdf77cb3e65ac90136/72799/target-binary.png 320w\"\n        sizes=\"(max-width: 320px) 100vw, 320px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>Now with the binary image we can find the contours in the image and determine their height and width. We do this by finding the bounding rectangles of the two areas of white in the image. We can get away with rectangles because the real life shapes are rectangles and our algorithm does not rely on their accuracy being high.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 320px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 80%; position: relative; bottom: 0; left: 0; background-image: url('data:image/svg+xml,%3csvg%20xmlns=\\'http://www.w3.org/2000/svg\\'%20width=\\'400\\'%20height=\\'320\\'%3e%3cpath%20d=\\'M0%20160v160h401V0H0v160m229-25l-9%201-8%201a188%20188%200%20004%2038c2%2015%202%2017%205%2017l3-1%205-1%205%201%201%201v-1c-1-2-1-2%201-2%203%200%203%200%203-4a279%20279%200%2001-3-23l-1-10c-1-16-2-18-4-18l-2%201m-101%209h-5l1%2022a173%20173%200%20002%2031c0%207-1%207%2013%205h8v-5l-1-4-1-17-2-25v-8h-5l-10%201\\'%20fill=\\'%23d3d3d3\\'%20fill-rule=\\'evenodd\\'/%3e%3c/svg%3e'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"The vision targets with bounding rectangles drawn\"\n        title=\"The vision targets with bounding rectangles drawn\"\n        src=\"/static/d85a8f8cab29f1bded702a28ebe506eb/72799/target-min-area-rect-labled.png\"\n        srcset=\"/static/d85a8f8cab29f1bded702a28ebe506eb/5a46d/target-min-area-rect-labled.png 300w,\n/static/d85a8f8cab29f1bded702a28ebe506eb/72799/target-min-area-rect-labled.png 320w\"\n        sizes=\"(max-width: 320px) 100vw, 320px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>Now that we know the location and sizes of the two rectangles we can proceed to find the distance of the target and the angle of the target with respect to the camera. That is the angle perceived by the camera not the yaw of the peg.</p>\n<p><img src=\"../../../images/resources/courses/vision-tracking/camera-distance.svg\" alt=\"A camera looking at a vision target at distance d\"></p>\n<p>To calculate the distance d in the figure above we simply have to relate the two sides of the right triangle with the angle θ. To do this we can use the tangent function, solving for the distance yields <span class=\"nobr\"><strong>d = h / tan(θ)</strong></span>. However we still have to calculate theta as we are dealing with pixels not with angles. To do this we can set up a proportion between the number of vertical pixels of the camera and its field of vision. So <span class=\"nobr\"><strong>θ = T<sub>h</sub> / C<sub>h</sub> * C<sub>vFOV</sub></strong></span> where θ is the angle T<sub>h</sub> is the height of the target in pixels, C<sub>h</sub> is the vertical camera resolution and C<sub>vFOV</sub> is the\nvertical field of vision of the camera in degrees. It can be better to determine the FOV empirically rather than going off of a specification. This same process can be applied to calculating the rotation with respect to the camera.</p>\n<p><img src=\"../../../images/resources/courses/vision-tracking/camera-rotation.svg\" alt=\"A camera looking at a vision target at angle θ\"></p>\n<p>To calculate the rotation of the target relative to the camera as in the image above a simple proportion can be used. <span class=\"nobr\"><strong>θ = (2T<sub>x</sub>-C<sub>w</sub>) / C<sub>w</sub> * C<sub>hFOV</sub>/2</strong></span> The equation is derived from getting a percent to either the left or right and then multiplying it by half of the horizontal field of view. T<sub>x</sub> is the targets x location in pixels C<sub>w</sub> is the camera width in pixels and C<sub>hFOV</sub> is the camera horizontal FOV.</p>\n<p>Congratulations! Now we have calculated the distance and the angle of the vision targets from only an image given by the camera.</p>","frontmatter":{"path":"/resources/courses/vision-tracking","title":"Vision Tracking Training"}}},"pageContext":{"isCreatedByStatefulCreatePages":false}}}